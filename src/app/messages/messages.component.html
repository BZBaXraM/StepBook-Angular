<div class="container mx-auto mt-4 px-4">
	<mat-card class="mb-4">
		<mat-card-content>
			<mat-button-toggle-group
				[(ngModel)]="container"
				(change)="getMessages()"
				class="w-full"
			>
				<mat-button-toggle value="Unread" class="w-1/3">
					<mat-icon class="align-middle">mark_email_unread</mat-icon>
					<span class="ml-1">Unread</span>
				</mat-button-toggle>
				<mat-button-toggle value="Inbox" class="w-1/3">
					<mat-icon class="align-middle">inbox</mat-icon>
					<span class="ml-1">Inbox</span>
				</mat-button-toggle>
				<mat-button-toggle value="Outbox" class="w-1/3">
					<mat-icon class="align-middle">send</mat-icon>
					<span class="ml-1">Outbox</span>
				</mat-button-toggle>
			</mat-button-toggle-group>
		</mat-card-content>
	</mat-card>

	@if (!messageService.paginatedResult()?.items ||
	messageService.paginatedResult()?.items?.length === 0) {
	<mat-card class="text-center py-6">
		<mat-icon class="text-5xl text-gray-400">inbox</mat-icon>
		<h3 class="text-xl font-medium text-gray-600 mt-3">No messages</h3>
	</mat-card>
	} @else {
	<mat-card class="overflow-hidden">
		<table
			mat-table
			[dataSource]="messageService.paginatedResult()?.items ?? []"
			class="w-full"
		>
			<ng-container matColumnDef="message">
				<th mat-header-cell *matHeaderCellDef class="font-medium">
					Message
				</th>
				<td mat-cell *matCellDef="let item" class="max-w-md truncate">
					{{ item.Content }}
				</td>
			</ng-container>

			<ng-container matColumnDef="user">
				<th mat-header-cell *matHeaderCellDef class="font-medium">
					From / To
				</th>
				<td mat-cell *matCellDef="let item">
					<div class="flex items-center gap-2">
						<img
							class="rounded-full h-8 w-8 object-cover"
							[src]="
								isOutbox
									? item.recipientPhotoUrl || 'user.png'
									: item.senderPhotoUrl || 'user.png'
							"
							alt="User avatar"
						/>
						<span>{{
							isOutbox
								? item.RecipientUsername
								: item.SenderUsername
						}}</span>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="date">
				<th mat-header-cell *matHeaderCellDef class="font-medium">
					Sent / Received
				</th>
				<td mat-cell *matCellDef="let item" class="text-gray-600">
					{{
						item.MessageSent
							? (item.MessageSent | timeago)
							: "Unknown time"
					}}
				</td>
			</ng-container>

			<ng-container matColumnDef="actions">
				<th mat-header-cell *matHeaderCellDef class="font-medium">
					Actions
				</th>
				<td mat-cell *matCellDef="let item">
					<button
						mat-icon-button
						color="warn"
						class="opacity-75 hover:opacity-100"
						(click)="
							deleteMessage(item.Id); $event.stopPropagation()
						"
					>
						<mat-icon>delete</mat-icon>
					</button>
				</td>
			</ng-container>

			<tr
				mat-header-row
				*matHeaderRowDef="['message', 'user', 'date', 'actions']"
			></tr>
			<tr
				mat-row
				*matRowDef="
					let row;
					columns: ['message', 'user', 'date', 'actions']
				"
				[routerLink]="getRoute(row)"
				[queryParams]="{ tab: 'Messages' }"
				class="hover:bg-gray-50 cursor-pointer transition-colors"
			></tr>
		</table>
	</mat-card>
	} @if (messageService.paginatedResult()?.pagination &&
	messageService.paginatedResult()?.pagination?.totalItems! > 0) {
	<div class="mt-4 flex justify-center">
		<pagination
			[boundaryLinks]="true"
			[totalItems]="
				messageService.paginatedResult()?.pagination?.totalItems!
			"
			[itemsPerPage]="
				messageService.paginatedResult()?.pagination?.itemsPerPage!
			"
			[ngModel]="
				messageService.paginatedResult()?.pagination?.currentPage!
			"
			(pageChanged)="pageChanged($event)"
			previousText="&lsaquo;"
			nextText="&rsaquo;"
			firstText="&laquo;"
			lastText="&raquo;"
			class="pagination-sm"
		>
		</pagination>
	</div>
	}
</div>
