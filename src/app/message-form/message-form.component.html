<form
	#messageForm="ngForm"
	(ngSubmit)="sendMessage()"
	class="flex flex-col gap-4 relative"
>
	<mat-form-field appearance="fill" class="w-full">
		<mat-label>Message...</mat-label>
		<textarea
			matInput
			name="messageContent"
			required
			[(ngModel)]="messageContent"
			(ngModelChange)="onMessageContentChange()"
			cdkTextareaAutosize
			cdkAutosizeMinRows="3"
			cdkAutosizeMaxRows="10"
			(keydown.enter)="sendMessage()"
		></textarea>
	</mat-form-field>

	<div class="flex justify-between items-center">
		<div class="flex gap-2 relative">
			<button
				mat-icon-button
				type="button"
				color="primary"
				(click)="fileInput?.click()"
				matTooltip="Send a file"
			>
				<mat-icon>attach_file</mat-icon>
			</button>

			<input
				type="file"
				(change)="onFileChange($event)"
				class="hidden"
				id="fileInput"
				#fileInput
			/>

			<button
				mat-icon-button
				type="button"
				color="primary"
				(click)="toggleEmojiMenu()"
				matTooltip="Add emoji"
			>
				<mat-icon>emoji_emotions</mat-icon>
			</button>

			<emoji-mart
				*ngIf="showEmojiMenu"
				[style]="{
					position: 'absolute',
					bottom: '50px',
					left: '0',
					zIndex: 1000
				}"
				[enableSearch]="false"
				(emojiClick)="addEmoji($event)"
			></emoji-mart>

			<button
				mat-icon-button
				type="button"
				color="primary"
				[ngClass]="{ recording: isRecording }"
				(click)="isRecording ? stopRecording() : startRecording()"
				matTooltip="{{
					isRecording ? 'Stop Recording' : 'Record Audio'
				}}"
			>
				<mat-icon>{{ isRecording ? "stop" : "mic" }}</mat-icon>
			</button>
		</div>

		<button
			mat-raised-button
			color="primary"
			[disabled]="!messageForm.valid"
			type="submit"
		>
			<mat-icon>send</mat-icon>
			<span class="ml-1">Send</span>
		</button>
	</div>
</form>
